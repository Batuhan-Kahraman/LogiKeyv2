@model EntityLayer.Concrate.CariHareket

@{
    ViewData["Title"] = "Cari Ödeme Hareket Ekle";
}
<div class="col-lg-30 col-xxl-12">

    <h2 class="mb-3 lh-sm">Cari Ödeme Hareket Ekle</h2>
    @if (TempData["Msg"] != null)
    {
        <div class="d-flex">
            <div class="toast show align-items-center text-white dark__text-gray-1100 border-0 m-3" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true" style="background:@TempData["Bgcolor"]">
                <div class="d-flex">
                    <div>
                        @TempData["Msg"]
                    </div>

                </div>
            </div>
        </div>

    }


    <div class="border table-responsive scrollbar p-2">
        <form method="post">
            <table class="table table-borderless">

                <tr>

                    <td>Cari</td>
                    <td colspan="2">
                        <select class="form-control" asp-for="CariID" id="CariID" required>
                            <option value="" disabled selected>Seçiniz</option>
                        </select>

                    </td>

                    <td>Ödeme Yöntemi</td>
                    <td colspan="2">
                        <select class="form-control" asp-for="OdemeYontemi" id="OdemeYontemi" required onchange="OdemeYontemiDegistir()">
                            <option value="" disabled selected>Seçiniz</option>
                            <option value="Kredi Kartı">Kredi Kartı</option>
                            <option value="Havale">Havale</option>
                            <option value="Senet">Senet</option>
                            <option value="Çek">Çek</option>
                        </select>
                    </td>

                </tr>

                <tr id="KrediKartSatir" style="display: none;">
                    <td>Kredi Kart No</td>
                    <td>
                        <input type="text" asp-for="KrediKartNo" id="KrediKartNo" class="form-control" />
                    </td>
                    <td>Ödeme Tutarı</td>
                    <td>
                        <input type="number" step="0.01" asp-for="KrediTutar" id="KrediTutar" class="form-control" />
                    </td>
                    <td>Ödeme Tarihi</td>
                    <td>
                        <input type="datetime" asp-for="KrediTarih" id="KrediTarih" class="form-control" />
                    </td>
                </tr>
                <tr id="HavaleSatir" style="display: none;">
                    <td>Havale Banka</td>
                    <td>
                        <select class="form-control" asp-for="HavaleBankaID" id="HavaleBankaID">
                            <option value="" disabled selected>Seçiniz</option>
                        </select>
                    </td>
                    <td>Havale Tutarı</td>
                    <td>
                        <input type="number" step="0.01" asp-for="HavaleTutar" id="HavaleTutar" class="form-control" />
                    </td>
                    <td>Havale Tarihi</td>
                    <td>
                        <input type="datetime" asp-for="HavaleTarih" id="HavaleTarih" class="form-control" />
                    </td>
                </tr>
                <tr id="CekSatir" style="display: none;">
                    <td>Çek Seri No</td>
                    <td>
                        <input type="text" asp-for="CekSeriNo" id="CekSeriNo" class="form-control" />
                    </td>
                    <td>Çek Tutarı</td>
                    <td>
                        <input type="number" step="0.01" asp-for="CekTutar" id="CekTutar" class="form-control" />
                    </td>
                    <td>Çek Tarihi</td>
                    <td>
                        <input type="datetime" asp-for="CekVadeTarihi" id="CekVadeTarihi" class="form-control" />
                    </td>
                </tr>
                <tr id="SenetSatir" style="display: none;">
                    <td>Senet Tutarı</td>
                    <td>
                        <input type="number" step="0.01" asp-for="SenetTutar" id="SenetTutar" class="form-control" />
                    </td>
                    <td>Senet Tarihi</td>
                    <td>
                        <input type="datetime" asp-for="SenetTarihi" id="SenetTarihi" class="form-control" />
                    </td>
                </tr>

            </table>
            <input type="submit" class="btn btn-success w-100" value="Ödeme Kaydet" />
        </form>


    </div>

</div>
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>

        $(document).ready(function () {
            $('select').select2();
        });

    </script>
    <script>

        function CariListe() {
            //araç tür listele
            $.ajax({
                url: '../../Ajax/CariListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#CariID').empty();
                    $('#CariID').append($('<option>', {
                        value: "", // Verinin değer özelliği
                        text: "Seçiniz", // Verinin görünen metni
                        disabled: true, // Option elementini devre dışı bırak
                        selected: true  // Option elementini seçili yap
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        if (@Model.CariID== item.cari_ID) {
                            $('#CariID').append($('<option>', {
                                value: item.cari_ID, // Verinin değer özelliği
                                text: item.cari_Unvan, // Verinin değer özelliği
                                selected:true
                                // Verinin görünen metni
                            }));
                        }
                        else {

                            $('#CariID').append($('<option>', {
                                value: item.cari_ID, // Verinin değer özelliği
                                text: item.cari_Unvan, // Verinin değer özelliği
                                // Verinin görünen metni
                            }));
                        }
                    });


                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });


        }
        CariListe();
        function BankaListe() {
            //banka listele
            $.ajax({
                url: '../../Ajax/BankaListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#HavaleBankaID').empty();
                    $('#HavaleBankaID').append($('<option>', {
                        value: "", // Verinin değer özelliği
                        text: "Seçiniz", // Verinin görünen metni
                        disabled: true, // Option elementini devre dışı bırak
                        selected: true  // Option elementini seçili yap
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#HavaleBankaID').append($('<option>', {
                            value: item.id, // Verinin değer özelliği
                            text: item.adi, // Verinin değer özelliği
                            // Verinin görünen metni
                        }));
                    });


                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });

            var HavaleBankaID = @Json.Serialize(Model.HavaleBankaID);

            if (HavaleBankaID !== null) {
                document.getElementById("HavaleBankaID").value = HavaleBankaID;
            }
        }
        BankaListe();

        function OdemeYontemiDegistir() {
            
            var OdemeYontemi = document.getElementById("OdemeYontemi").value;

            document.getElementById("KrediKartSatir").style.display = "none";
            document.getElementById("HavaleSatir").style.display = "none";
            document.getElementById("CekSatir").style.display = "none";
            document.getElementById("SenetSatir").style.display = "none";

            // Seçili ödeme yöntemine göre alanları göster
            if (OdemeYontemi === "Kredi Kartı") {
                document.getElementById("KrediKartSatir").style.display = "table-row";

                document.getElementById("HavaleTutar").value = "";
                document.getElementById("HavaleTarih").value = "";
                document.getElementById("HavaleBankaID").value = "";
                document.getElementById("CekSeriNo").value = "";
                document.getElementById("CekTutar").value = "";
                document.getElementById("CekVadeTarihi").value = "";
                document.getElementById("SenetTarihi").value = "";
                document.getElementById("SenetTutar").value = "";

            } else if (OdemeYontemi === "Çek") {
                document.getElementById("CekSatir").style.display = "table-row";

                document.getElementById("KrediKartNo").value = "";
                document.getElementById("KrediTutar").value = "";
                document.getElementById("KrediTarih").value = "";
                document.getElementById("HavaleTutar").value = "";
                document.getElementById("HavaleTarih").value = "";
                document.getElementById("HavaleBankaID").value = "";
                document.getElementById("SenetTarihi").value = "";
                document.getElementById("SenetTutar").value = "";

            } else if (OdemeYontemi === "Senet") {
                document.getElementById("SenetSatir").style.display = "table-row";

                document.getElementById("KrediKartNo").value = "";
                document.getElementById("KrediTutar").value = "";
                document.getElementById("KrediTarih").value = "";
                document.getElementById("HavaleTutar").value = "";
                document.getElementById("HavaleTarih").value = "";
                document.getElementById("HavaleBankaID").value = "";
                document.getElementById("CekSeriNo").value = "";
                document.getElementById("CekTutar").value = "";
                document.getElementById("CekVadeTarihi").value = "";


            } else if (OdemeYontemi === "Havale") {
                document.getElementById("HavaleSatir").style.display = "table-row";

                document.getElementById("KrediKartNo").value = "";
                document.getElementById("KrediTutar").value = "";
                document.getElementById("KrediTarih").value = "";
                document.getElementById("CekSeriNo").value = "";
                document.getElementById("CekTutar").value = "";
                document.getElementById("CekVadeTarihi").value = "";
                document.getElementById("SenetTarihi").value = "";
                document.getElementById("SenetTutar").value = "";
            }
        }
        OdemeYontemiDegistir();

    </script>
}
