@model EntityLayer.Concrate.Kaza

@{
    ViewData["Title"] = "Kaza Ekle";
}
<div class="col-lg-30 col-xxl-12">

    <h2 class="mb-3 lh-sm">Kaza Ekle</h2>
    @if (TempData["Msg"] != null)
    {
        <div class="d-flex">
            <div class="toast show align-items-center text-white dark__text-gray-1100 border-0 m-3" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true" style="background:@TempData["Bgcolor"]">
                <div class="d-flex">
                    <div>
                        @TempData["Msg"]
                    </div>

                </div>
            </div>
        </div>

    }

    <div class="border table-responsive scrollbar p-2">
        <form method="post" enctype="multipart/form-data">
            <input type="hidden" class="form-control" asp-for="ID" />
            <table class="table table-borderless">
                <!-- Sahiplik -->
                <tr>
                    <td>
                        <span style="color:red;">*</span>Plaka
                    </td>
                    <td>
                        <a asp-controller="Arac" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="AracListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="AracID" id="AracID" required>
                            <option value="" disabled selected>Seçiniz</option>
                        </select>
                    </td>
                    <td>Kaza Tarihi</td>
                    <td><input type="date" class="form-control" asp-for="KazaTarihi" /></td>
                    <td>Kaza Türü</td>
                    <td>
                        <a asp-controller="KazaTuru" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="KazaTuruListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="KazaTuruID" id="KazaTuruID">
                            <option value="0">Seçiniz</option>
                        </select>

                    </td>
                </tr>
                <tr>
                    <td>Sürücü</td>
                    <td>
                        <a asp-controller="Surucu" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="SurucuListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="SurucuID" id="SurucuID">
                            <option value="0">Seçiniz</option>

                        </select>
                    </td>
                    <td>Karşı Plaka</td>
                    <td>
                        <input type="text" class="form-control" asp-for="KarsiPlaka" />
                    </td>
                    <td>Karşı Araç Ruhsat Sahibi</td>
                    <td>
                        <input type="text" class="form-control" asp-for="KarsiAracRuhsatSahibi" />
                    </td>
                </tr>
                <tr>
                    <td>Karşı Sürücü T.C.</td>
                    <td><input type="text" class="form-control" asp-for="KarsiSurucuTC" /></td>
                    <td>Karşı Sürücü Adı Soyadi</td>
                    <td><input type="text" class="form-control" asp-for="KarsiAracSurucuAdiSoyadi" /></td>
                    <td>Karşı Sürücü Cep Telefonu</td>
                    <td><input type="text" class="form-control" asp-for="KarsiAracCepTelefonu" /></td>
                </tr>
                <tr>
                    <td>Sürücümüz Kusur Oranı</td>
                    <td><input type="text" class="form-control" asp-for="SurucumuzKusurOrani" /></td>
                    <td>Karşı Sürücü Kusur Oranı</td>
                    <td><input type="text" class="form-control" asp-for="KarsiSurucuKusurOrani" /></td>
                    <td>Kaza Rapor No</td>
                    <td><input type="text" class="form-control" asp-for="KazaRaporNo" /></td>
                </tr>
                <tr>
                    <td>Sigprta Acente Adı</td>
                    <td>
                        <input type="text" class="form-control" asp-for="SigortaAcenteAdi" />

                    </td>
                    <td>Sigorta Acente Yetkilisi</td>
                    <td>
                        <input type="text" class="form-control" asp-for="SigortaAcenteYetkilisi" />

                    </td>
                    <td>Sigorta Acente Telefonu</td>
                    <td><input type="text" class="form-control" asp-for="SigortaAcenteTelefonu" /></td>
                </tr>
                <tr>
                    <td>Hasar Faturası Firması</td>
                    <td>
                        <input type="text" class="form-control" asp-for="HasarFaturaFirmasi" />
                    </td>
                    <td>Hasar Fatura Tarihi</td>
                    <td><input type="date" class="form-control" asp-for="HasarFaturaTarihi" /></td>
                    <td>Geri Ödeme Tarihi</td>
                    <td><input type="date" class="form-control" asp-for="GeriOdemeTarihi" /></td>

                </tr>
                <tr>
                    <td>Hasar Tutarı</td>
                    <td><input type="number" class="form-control" asp-for="HasarTutari" /></td>
                    <td>Sigortanın Ödediği</td>
                    <td><input type="number" class="form-control" asp-for="SigortaninOdedigiTutar" /></td>
                    <td>Ödenemeyen Tutar</td>
                    <td><input type="text" class="form-control" asp-for="OdenemeyenTutar" /></td>
                </tr>
                <tr>
                    <td>Servis Firması Adı</td>
                    <td><input type="text" class="form-control" asp-for="ServisFirmaAdi" /></td>
                    <td>Servis Yetkilisi</td>
                    <td><input type="text" class="form-control" asp-for="ServisFirmaYetkilisi" /></td>
                    <td>Servis Telefonu</td>
                    <td><input type="text" class="form-control" asp-for="ServisFirmaTelefonu" /></td>
                </tr>
                <tr>
                    <td>Servis Firma Adresi</td>
                    <td colspan="5">
                        <textarea rows="2" asp-for="ServisFirmaAdres" class="form-control"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>Not</td>
                    <td colspan="5">
                        <textarea rows="2" asp-for="Notlar" class="form-control"></textarea>
                    </td>
                </tr>
                <tr>
                    <td colspan="6">Belge Yükle</td>
                </tr>
                <tr>
                    <td>Kaza Raporu</td>
                    <td>
                        @{
                            if (Model.KazaRaporu != "" && Model.KazaRaporu != null)
                            {
                                        <a href="../upload/@Model.KazaRaporu" target="_blank">
                                            Göster
                                        </a>
                            }
                        }
                    </td>
                    <td><input type="file" name="KazaRaporu" class="form-control" /></td>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td>Karşı Taraf Trafik Sigortası</td>
                    <td>
                        @{
                            if (Model.KarsiTarafTrafikSigortasi != "" && Model.KarsiTarafTrafikSigortasi != null)
                            {
                                        <a href="../upload/@Model.KarsiTarafTrafikSigortasi" target="_blank">
                                            Göster
                                        </a>
                            }
                        }
                    </td>
                    <td><input type="file" name="KarsiTarafTrafikSigortasi" class="form-control" /></td>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td>Karşı Taraf Kasko Poliçesi</td>
                    <td>
                        @{
                            if (Model.KarsiTarafKaskoPolicesi != "" && Model.KarsiTarafKaskoPolicesi != null)
                            {
                                        <a href="../upload/@Model.KarsiTarafKaskoPolicesi" target="_blank">
                                            Göster
                                        </a>
                            }
                        }
                    </td>
                    <td><input type="file" name="KarsiTarafKaskoPolicesi" class="form-control" /></td>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td>Karşı Taraf Ruhsat</td>
                    <td>
                        @{
                            if (Model.KarsiTarafRuhsat != "" && Model.KarsiTarafRuhsat != null)
                            {
                                        <a href="../upload/@Model.KarsiTarafRuhsat" target="_blank">
                                            Göster
                                        </a>
                            }
                        }
                    </td>
                    <td><input type="file" name="KarsiTarafRuhsat" class="form-control" /></td>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td>Karşı Taraf Ehliyet</td>
                    <td>
                        @{
                            if (Model.KarsiTarafEhliyet != "" && Model.KarsiTarafEhliyet != null)
                            {
                                        <a href="../upload/@Model.KarsiTarafEhliyet" target="_blank">
                                            Göster
                                        </a>
                            }
                        }
                    </td>
                    <td><input type="file" name="KarsiTarafEhliyet" class="form-control" /></td>
                    <td colspan="4"></td>

                </tr>
                <tr>
                    <td>Resimler</td>

                    @{
                        if (Model.KazaResimleri != "" && Model.KazaResimleri != null)
                        {

                                    <td>
                                        <a href="../upload/@Model.KazaResimleri" target="_blank">Göster</a>
                                    </td>
                        }

                        }
                    <td colspan="5"><input type="file" name="KazaResimleri" class="form-control"  /></td>
                </tr>
            </table>
            <input type="submit" class="btn btn-success w-100" value="Kaza Düzenle" />
        </form>


    </div>

</div>
@section Scripts {

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>

        $(document).ready(function () {
            $('select').select2();
        });
    </script>
    <script>
        function AracListe() {

            //plaka listele
            $.ajax({
                url: '../Ajax/PlakaListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#AracID').empty();
                    $('#AracID').append($('<option>', {
                        value: "", // Verinin değer özelliği
                        text: "Seçiniz", // Verinin görünen metni
                        disabled: true,
                        selected: true
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#AracID').append($('<option>', {
                            value: item.id, // Verinin değer özelliği
                            text: item.plaka // Verinin görünen metni
                        }));
                    });
                    var AracID = @Json.Serialize(Model.AracID);

                    if (AracID !== null) {
                        document.getElementById("AracID").value = AracID;
                    }
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
        }
        AracListe();
        function SurucuListe() {

            //sürücü listele
            $.ajax({
                url: '../Ajax/SurucuListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#SurucuID').empty();
                    $('#SurucuID').append($('<option>', {
                        value: 0, // Verinin değer özelliği
                        text: "Seçiniz" // Verinin görünen metni
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#SurucuID').append($('<option>', {
                            value: item.kullanici_ID, // Verinin değer özelliği
                            text: item.kullanici_Isim + ' ' + item.kullanici_Soyisim // Verinin görünen metni
                        }));
                    });
                    var SurucuID = @Json.Serialize(Model.SurucuID);

                    if (SurucuID !== null) {
                        document.getElementById("SurucuID").value = SurucuID;
                    }
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
        }

        SurucuListe();

        function KazaTuruListe() {
        //kaza türü listele
        $.ajax({
            url: '../Ajax/KazaTuruListe', // Verileri sağlayan API'nin endpoint'i
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                $('#KazaTuruID').empty();
                $('#KazaTuruID').append($('<option>', {
                    value: 0, // Verinin değer özelliği
                    text: "Seçiniz" // Verinin görünen metni
                }));
                // Verileri selectbox'a ekle
                $.each(data, function (index, item) {
                    console.log(item);
                    $('#KazaTuruID').append($('<option>', {
                        value: item.id, // Verinin değer özelliği
                        text: item.adi // Verinin görünen metni
                    }));
                });

                var KazaTuruID = @Json.Serialize(Model.KazaTuruID);

                if (KazaTuruID !== null) {
                    document.getElementById("KazaTuruID").value = KazaTuruID;
                }
            },
            error: function (error) {
                console.log('Hata oluştu:', error);
            }
        });
        }
        KazaTuruListe();
    </script>
}