@model EntityLayer.Concrate.MasrafCeza

@{
    ViewData["Title"] = "Masraf / Ceza Düzenle";
}
<div class="col-lg-30 col-xxl-12">

    <h2 class="mb-3 lh-sm">Masraf / Ceza Düzenle</h2>
    @if (TempData["Msg"] != null)
    {
        <div class="d-flex">
            <div class="toast show align-items-center text-white dark__text-gray-1100 border-0 m-3" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true" style="background:@TempData["Bgcolor"]">
                <div class="d-flex">
                    <div>
                        @TempData["Msg"]
                    </div>

                </div>
            </div>
        </div>

    }

    <div class="border table-responsive scrollbar p-2">
        <form method="post">
            <input type="hidden" asp-for="ID" />
            <table class="table table-borderless">
                <tr>
                    <td colspan="6">
                        <a asp-controller="MasrafTur" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="MasrafTurListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="Tur" onchange="turDegis(this.value)" required>
                            <option value="" disable selected>Tür Seçiniz</option>
                           
                        </select>

                    </td>
                </tr>
                <tr>
                    <td>Plaka</td>
                    <td>
                        <a asp-controller="Arac" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="AracListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="AracID" id="AracID" required>
                            <option value="" disable selected>Tür Seçiniz</option>
                        </select>
                    </td>
                    <td>Sürücü</td>
                    <td>
                        <a asp-controller="Surucu" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="SurucuListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="SurucuID" id="SurucuID" required>
                            <option value="" disable selected>Tür Seçiniz</option>
                        </select>

                    </td>
                    <td id="tedarikciTD1" style="display:none;">Tedarikçi</td>
                    <td id="tedarikciTD2" style="display:none;">
                        <a asp-controller="Surucu" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="TedarikciListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="TedarikciID" id="TedarikciID">
                            <option value="0">Seçiniz</option>
                        </select>

                    </td>
                </tr>
                <tr>
                    <td>Belgeli / Belgesiz</td>
                    <td>
                        <a asp-controller="YakitTipi" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="YakitTipiListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="YakitTipiID" id="YakitTipiID">
                            <option value="0">Seçiniz</option>

                        </select>
                    </td>
                    <td>Fatura Tarihi</td>
                    <td>
                        <input type="date" class="form-control" asp-for="FaturaTarihi" />
                    </td>
                    <td>Fatura No</td>
                    <td>
                        <input type="text" class="form-control" asp-for="FaturaNo" />
                    </td>
                </tr>
                <tr>
                    <td>Araç KM</td>
                    <td><input type="text" class="form-control" asp-for="AracKM" /></td>
                  </tr>
                  <tr>
                    <td>Masraf Tipi</td>
                    <td>
                        <a asp-controller="MasrafTipi" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="MasrafTipListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="MasrafTipiID" id="MasrafTipiID">
                            <option value="0">Seçiniz</option>

                        </select>
                    </td>
                    <td>Masraf Detay</td>
                    <td colspan="3">
                        <textarea class="form-control" asp-for=MasrafDetay></textarea>
                    </td>
                </tr>
                <tr>
                    <td>KDV Dahil Mi?</td>
                    <td>
                        <select class="form-control" asp-for="KdvDahilMi" onchange="KDVHesap()" id="KDVDahilmi">
                            <option value="True">Evet</option>
                            <option value="False">Hayır</option>
                        </select>

                    </td>

                    <td>KDV</td>
                    <td>
                        <a asp-controller="KDVOrani" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="KdvListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="KDV" id="KDV" onchange="KDVHesap()">
                            <option value="0">Seçiniz</option>
                        </select>

                    </td>
                    <td>Birim Fiyat</td>
                    <td><input type="number" class="form-control" asp-for="BirimFiyat" id="BirimFiyat" onchange="KDVHesap()" /></td>

                </tr>
                <tr>
                    <td>
                        Tutar
                    </td>
                    <td><input type="number" class="form-control" asp-for="ToplamTutar" id="ToplamTutar" onchange="KDVHesap()" /></td>
                </tr>
                    <tr>
                    <td>Notlar</td>
                    
                    <td colspan="5">
                        <textarea rows="2" asp-for="Notlar" class="form-control"></textarea>
                    </td>
                </tr>
              
            </table>
            <input type="submit" class="btn btn-success w-100" value="Masraf / Ceza Kaydet" />
        </form>


    </div>

</div>
@section Scripts {

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>

        $(document).ready(function () {
            $('select').select2();
        });
    </script>
    <script>

        function MasrafTurListe() {
            //masraf tür listele
            $.ajax({
                url: '../Ajax/MasrafTuruListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#Tur').empty();
                    $('#Tur').append($('<option>', {
                        value: 0, // Verinin değer özelliği
                        text: "Seçiniz" // Verinin görünen metni
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#Tur').append($('<option>', {
                            value: item.id, // Verinin değer özelliği
                            text: item.adi // Verinin görünen metni
                        }));
                    });
                    var Tur = @Json.Serialize(Model.Tur);

                    if (Tur !== null) {
                        document.getElementById("Tur").value = Tur;
                }
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
        }
        MasrafTurListe();


        function AracListe() {
        //plaka listele
        $.ajax({
            url: '../Ajax/PlakaListe', // Verileri sağlayan API'nin endpoint'i
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                $('#AracID').empty();
                $('#AracID').append($('<option>', {
                    value: "", // Verinin değer özelliği
                    text: "Seçiniz", // Verinin görünen metni
                    disabled: true,
                    selected: true
                }));
                // Verileri selectbox'a ekle
                $.each(data, function (index, item) {
                    console.log(item);
                    $('#AracID').append($('<option>', {
                        value: item.id, // Verinin değer özelliği
                        text: item.plaka // Verinin görünen metni
                    }));
                });
                var AracID = @Json.Serialize(Model.AracID);

                if (AracID !== null) {
                    document.getElementById("AracID").value = @Model.AracID;
                }
            },
            error: function (error) {
                console.log('Hata oluştu:', error);
            }
        });
        }

        AracListe();

        function SurucuListe() {
            //sürücü listele
            $.ajax({
                url: '../Ajax/SurucuListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#SurucuID').empty();
                    $('#SurucuID').append($('<option>', {
                        value: "", // Verinin değer özelliği
                        text: "Seçiniz", // Verinin görünen metni
                        disabled: true,
                        selected: true
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#SurucuID').append($('<option>', {
                            value: item.kullanici_ID, // Verinin değer özelliği
                            text: item.kullanici_Isim + ' ' + item.kullanici_Soyisim // Verinin görünen metni
                        }));
                    });
                    var SurucuID = @Json.Serialize(Model.SurucuID);

                    if (SurucuID != null) {
                        document.getElementById("SurucuID").value = @Model.SurucuID;
                    }
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
        }
        
        SurucuListe();


        function TedarikciListe() {
            //sürücü listele
            $.ajax({
                url: '../Ajax/TedarikciListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#TedarikciID').empty();
                    $('#TedarikciID').append($('<option>', {
                        value: 0, // Verinin değer özelliği
                        text: "Seçiniz" // Verinin görünen metni
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#TedarikciID').append($('<option>', {
                            value: item.kullanici_ID, // Verinin değer özelliği
                            text: item.kullanici_Isim + ' ' + item.kullanici_Soyisim // Verinin görünen metni
                        }));
                    });
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
        }
        TedarikciListe();

        function YakitTipiListe() {
            //yakıt tipi listele
            $.ajax({
                url: '../Ajax/YakitTipiListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#YakitTipiID').empty();
                    $('#YakitTipiID').append($('<option>', {
                        value: 0, // Verinin değer özelliği
                        text: "Seçiniz" // Verinin görünen metni
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#YakitTipiID').append($('<option>', {
                            value: item.id, // Verinin değer özelliği
                            text: item.adi // Verinin görünen metni
                        }));
                    });
                    var YakitTipiID = @Json.Serialize(Model.YakitTipiID);

                    if (YakitTipiID !== null) {
                        document.getElementById("YakitTipiID").value = @Model.YakitTipiID;
                    }
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
        }

        YakitTipiListe();

        function MasrafTipiListe() {
        //masraf tipi listele
        $.ajax({
            url: '../Ajax/MasrafTipiListe', // Verileri sağlayan API'nin endpoint'i
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                $('#MasrafTipiID').empty();
                $('#MasrafTipiID').append($('<option>', {
                    value: 0, // Verinin değer özelliği
                    text: "Seçiniz" // Verinin görünen metni
                }));
                // Verileri selectbox'a ekle
                $.each(data, function (index, item) {
                    console.log(item);
                    $('#MasrafTipiID').append($('<option>', {
                        value: item.id, // Verinin değer özelliği
                        text: item.adi // Verinin görünen metni
                    }));
                });
                var MasrafTipiID = @Json.Serialize(Model.MasrafTipiID);

                if (MasrafTipiID !== null) {
                    document.getElementById("MasrafTipiID").value = @Model.MasrafTipiID;
                }
            },
            error: function (error) {
                console.log('Hata oluştu:', error);
            }
        });
        }
        MasrafTipiListe();

        function turDegis(item) {
            if (item == 1) {
                document.getElementById("tedarikciTD1").style.display = "";
                document.getElementById("tedarikciTD2").style.display = "";
            }
            else {
                document.getElementById("tedarikciTD1").style.display = "none";
                document.getElementById("tedarikciTD2").style.display = "none";
            }
        }

        function KdvListe() {
        //kdv listele
        $.ajax({
            url: '../Ajax/KDVListe', // Verileri sağlayan API'nin endpoint'i
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                $('#KDV').empty();
                $('#KDV').append($('<option>', {
                    value: 0, // Verinin değer özelliği
                    text: "Seçiniz" // Verinin görünen metni
                }));
                // Verileri selectbox'a ekle
                $.each(data, function (index, item) {
                    console.log(item);
                    $('#KDV').append($('<option>', {
                        value: item.oran, // Verinin değer özelliği
                        text: item.oran // Verinin görünen metni
                    }));
                });
                var KDV = @Json.Serialize(Model.KDV);

                if (KDV != null) {
                    document.getElementById("KDV").value = @Model.KDV;
                }
            },
            error: function (error) {
                console.log('Hata oluştu:', error);
            }
        });
        }
        KdvListe();

        function KDVHesap() {
            debugger;

            var BirimFiyat = $("#BirimFiyat").val();
            var KDV = $("#KDV").val();
            var KDVDahilmi = $("#KDVDahilmi").val();
            var ToplamTutar = $("#ToplamTutar").val();

            if (KDVDahilmi == "True") {
                var fiyat = ToplamTutar / (1 + (KDV / 100));
                fiyat = fiyat.toFixed(2);
                $("#BirimFiyat").val(fiyat);
                document.getElementById("BirimFiyat").readOnly = true;
                document.getElementById("ToplamTutar").readOnly = false;
            }
            else {
                var fiyat = BirimFiyat * (1 + (KDV / 100));
                fiyat = fiyat.toFixed(2);
                $("#ToplamTutar").val(fiyat);
                document.getElementById("BirimFiyat").readOnly = false;
                document.getElementById("ToplamTutar").readOnly = true;
            }
        }
    </script>
}