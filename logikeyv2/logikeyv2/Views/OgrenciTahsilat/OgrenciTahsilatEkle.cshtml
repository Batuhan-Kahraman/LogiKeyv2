@model EntityLayer.Concrate.OgrenciTahsilat

@{
    ViewData["Title"] = "Öğrenci Cari Ekle";
}
<div class="col-lg-30 col-xxl-12">

    <h2 class="mb-3 lh-sm">Öğrenci Cari Ekle</h2>
    @if (TempData["Msg"] != null)
    {
        <div class="d-flex">
            <div class="toast show align-items-center text-white dark__text-gray-1100 border-0 m-3" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true" style="background:@TempData["Bgcolor"]">
                <div class="d-flex">
                    <div>
                        @TempData["Msg"]
                    </div>

                </div>
            </div>
        </div>

    }
   
    <div class="border table-responsive scrollbar p-2">
        <form method="post">
            <table class="table table-borderless">

                <tr>

                    <td>
                        <span style="color:red;">*</span>Okul Adı
                    </td>
                    <td>

                        <a asp-controller="Okul" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="OkulListe()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" id="okulId" onchange="OkulSec()">
                            <option value="" disabled selected>Seçiniz</option>
                           
                        </select>

                    </td>
                    <td>
                        <span style="color:red;">*</span>Öğrenci Adı
                    </td>
                    <td>
                        <a asp-controller="Ogrenci" asp-action="Index" target="_blank" class="me-2">
                            <span class="text-body fs-5" data-feather="plus"></span>
                        </a>
                        <a onclick="OkulSec()" class="me-2" style="cursor:pointer;">
                            <span class="text-body fs-5" data-feather="refresh-ccw"></span>
                        </a>
                        <select class="form-control" asp-for="OgrenciId" id="OgrenciId" >
                            <option value="" disabled selected>Seçiniz</option>
                          

                        </select>

                    </td>

                </tr>
                <tr>
                    <td>Anlaşılan Tutar</td>
                    <td>
                        <input type="number" class="form-control" asp-for="AnlasilanTutar" />

                    </td>
                    <td>Taksit Sayısı</td>
                    <td>
                        <input type="number" class="form-control" asp-for="TaksitSayisi" />
                    </td>
                </tr>
               
                <tr>
                    <td>Anlaşma Tarihi</td>
                    <td> <input type="date" class="form-control" asp-for="AnlasmaTarihi" /></td>

                    <td>Vade Başlangıç Tarihi</td>
                    <td> <input type="date" class="form-control" asp-for="VadeBaslangicTarihi" /></td>
                </tr>
               
              



            </table>
            <input type="submit" class="btn btn-success w-100" value="Tahsilat Kaydet" />
        </form>


    </div>

</div>
   @section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>

        $(document).ready(function () {
            $('select').select2();
            const bugün = new Date();
            let yil = bugün.getFullYear();
            let ay = ('0' + (bugün.getMonth() + 1)).slice(-2); // Ayı iki haneli yapmak için
            let gün = ('0' + bugün.getDate()).slice(-2); // Günü iki haneli yapmak için
            var bugununTarihi = `${yil}-${ay}-${gün}`;
            $('input[type="date"]').each(function () {
                $(this).val(bugununTarihi);
            });
        });
    </script>
<script>
       
    function OkulSec() {
        var OkulId = document.getElementById("okulId").value;
        $.ajax({
            url: '../Ajax/OgrenciListe', // Verileri sağlayan API'nin endpoint'i
            method: 'GET',
            data: { OkulId: OkulId },
            dataType: 'json',
            success: function (data) {
                    console.log(data)

                $('#OgrenciId').empty();
                $('#OgrenciId').append($('<option>', {
                    value: 0, // Verinin değer özelliği
                    text: "Seçiniz" // Verinin görünen metni
                }));
                // Verileri selectbox'a ekle
                $.each(data, function (index, item) {
                    console.log(item);
                    $('#OgrenciId').append($('<option>', {
                        value: item.ogrenci.cari_ID, // Verinin değer özelliği
                        text: item.ogrenci.cari_Unvan // Verinin görünen metni
                    }));
                });
            },
            error: function (error) {
                console.log('Hata oluştu:', error);
            }
        });
    }

    function OkulListe() {
            $.ajax({
                url: '../Ajax/OkulListe', // Verileri sağlayan API'nin endpoint'i
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    console.log(data)

                    $('#okulId').empty();
                    $('#okulId').append($('<option>', {
                        value: 0, // Verinin değer özelliği
                        text: "Seçiniz" // Verinin görünen metni
                    }));
                    // Verileri selectbox'a ekle
                    $.each(data, function (index, item) {
                        console.log(item);
                        $('#okulId').append($('<option>', {
                            value: item.cari_ID, // Verinin değer özelliği
                            text: item.cari_Unvan // Verinin görünen metni
                        }));
                    });
                },
                error: function (error) {
                    console.log('Hata oluştu:', error);
                }
            });
    }
    OkulListe();
</script>
}